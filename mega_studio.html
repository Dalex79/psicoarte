<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Estudio S칩nico Psicod칠lico - 15 Experiencias</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --neon-lime: #39ff14;
            --neon-yellow: #fff01f;
            --neon-red: #ff3333;
            --bg-black: #050505;
            --panel-bg: rgba(20, 20, 30, 0.6);
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-black);
            color: white;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            text-align: center;
        }

        /* --- UI GLOBAL --- */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: var(--neon-pink); border-radius: 5px; }

        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000; transition: opacity 0.5s; cursor: pointer;
        }
        #start-overlay h1 { animation: pulse 1s infinite; color: var(--neon-cyan); font-size: 3rem; }

        nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--neon-pink);
            padding: 10px; overflow-x: auto; white-space: nowrap;
            display: flex; gap: 10px;
        }
        nav button {
            background: transparent; color: white; border: 1px solid var(--neon-cyan);
            padding: 5px 10px; font-size: 0.8rem; cursor: pointer;
        }
        nav button:hover { background: var(--neon-cyan); color: black; }

        section {
            min-height: 80vh; padding: 40px 20px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border-bottom: 2px dashed rgba(255,255,255,0.1);
            position: relative;
        }

        h2 { font-size: 2rem; margin-bottom: 10px; text-shadow: 2px 2px var(--neon-pink); }
        p { color: #aaa; margin-bottom: 20px; max-width: 600px; }

        canvas {
            background: rgba(255,255,255,0.05);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid #333;
            cursor: pointer;
            max-width: 100%;
        }

        button.control-btn {
            margin-top: 15px; padding: 10px 20px;
            background: #222; color: var(--neon-lime); border: 1px solid var(--neon-lime);
            cursor: pointer; font-family: inherit; font-weight: bold;
        }
        button.control-btn:hover { background: var(--neon-lime); color: black; }

        /* BOT칍N DE MUTE */
        .mute-toggle {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.5); border: 1px solid var(--neon-red);
            color: var(--neon-red); padding: 5px 10px; font-size: 0.8rem;
            cursor: pointer; transition: 0.3s;
        }
        .mute-toggle:hover { background: var(--neon-red); color: white; }
        .mute-toggle.muted { background: var(--neon-red); color: white; border-color: white; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Estilos Espec칤ficos */
        .seq-grid { display: grid; gap: 5px; }
        .seq-row { display: flex; gap: 5px; }
        .seq-cell { width: 30px; height: 30px; border: 1px solid #444; cursor: pointer; }
        .seq-cell.active { background: var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink); }
        .seq-cell.playing { border-color: white; transform: scale(1.1); }

    </style>
</head>
<body>

    <div id="start-overlay" onclick="initAudio()">
        <h1>CLICK PARA INICIAR EL SISTEMA</h1>
        <p>15 Experiencias Sonoras Cargadas</p>
    </div>

    <nav>
        <button onclick="scrollToId('hero')">TOP</button>
        <button onclick="scrollToId('s1')">1. Theremin</button>
        <button onclick="scrollToId('s2')">2. Secuenciador</button>
        <button onclick="scrollToId('s3')">3. Gravedad</button>
        <button onclick="scrollToId('s4')">4. Arpa</button>
        <button onclick="scrollToId('s5')">5. P칠ndulos</button>
        <button onclick="scrollToId('s6')">6. Prisma</button>
        <button onclick="scrollToId('s7')">7. Vocales</button>
        <button onclick="scrollToId('s8')">8. Burbujas</button>
        <button onclick="scrollToId('s9')">9. Ecos</button>
        <button onclick="scrollToId('s10')">10. Cuerda</button>
        <button onclick="scrollToId('s11')">11. 칍rbitas</button>
        <button onclick="scrollToId('s12')">12. Radio</button>
        <button onclick="scrollToId('s13')">13. Glitch</button>
        <button onclick="scrollToId('s14')">14. Doppler</button>
        <button onclick="scrollToId('s15')">15. Pintura</button>
    </nav>

    <section id="hero">
        <h1 style="font-size:3rem; color:var(--neon-lime)">MEGA ESTUDIO S칍NICO</h1>
        <p>Desciende por la madriguera del conejo digital.</p>
    </section>

    <!-- 1. THEREMIN -->
    <section id="s1">
        <button id="mute-s1" class="mute-toggle muted" onclick="toggleMute('s1')">游댆 ACTIVAR</button>
        <h2>1. Theremin de Luz</h2>
        <p>X = Tono | Y = Volumen</p>
        <canvas id="c1" width="600" height="300"></canvas>
    </section>

    <!-- 2. SECUENCIADOR -->
    <section id="s2">
        <button id="mute-s2" class="mute-toggle muted" onclick="toggleMute('s2')">游댆 ACTIVAR</button>
        <h2>2. Secuenciador Ne칩n</h2>
        <p>Crea patrones r칤tmicos.</p>
        <div id="sequencer" class="seq-grid"></div>
        <button class="control-btn" onclick="clearSeq()">Borrar Patr칩n</button>
    </section>

    <!-- 3. GRAVEDAD -->
    <section id="s3">
        <button id="mute-s3" class="mute-toggle muted" onclick="toggleMute('s3')">游댆 ACTIVAR</button>
        <h2>3. Gravedad Musical</h2>
        <p>Clic para soltar bolas que rebotan.</p>
        <canvas id="c3" width="600" height="300"></canvas>
        <button class="control-btn" onclick="balls=[]">Limpiar Bolas</button>
    </section>

    <!-- 4. ARPA L츼SER -->
    <section id="s4">
        <button id="mute-s4" class="mute-toggle muted" onclick="toggleMute('s4')">游댆 ACTIVAR</button>
        <h2>4. Arpa L치ser</h2>
        <p>Pasa el mouse sobre las cuerdas de luz.</p>
        <canvas id="c4" width="600" height="300"></canvas>
    </section>

    <!-- 5. P칄NDULOS -->
    <section id="s5">
        <button id="mute-s5" class="mute-toggle muted" onclick="toggleMute('s5')">游댆 ACTIVAR</button>
        <h2>5. P칠ndulos Polirr칤tmicos</h2>
        <p>F칤sica oscilatoria creando armon칤a.</p>
        <canvas id="c5" width="600" height="300"></canvas>
        <button class="control-btn" onclick="resetPendulums()">Sincronizar</button>
    </section>

    <!-- 6. PRISMA DE LUZ (ANTES LLUVIA) -->
    <section id="s6">
        <button id="mute-s6" class="mute-toggle muted" onclick="toggleMute('s6')">游댆 ACTIVAR</button>
        <h2>6. Prisma de Luz</h2>
        <p>Pinta con luz. La altura define la pureza del tono.</p>
        <canvas id="c6" width="600" height="300"></canvas>
    </section>

    <!-- 7. VOCALES (FORMANT) -->
    <section id="s7">
        <button id="mute-s7" class="mute-toggle muted" onclick="toggleMute('s7')">游댆 ACTIVAR</button>
        <h2>7. Sintetizador de Vocales</h2>
        <p>Mueve el mouse para cambiar entre A-E-I-O-U.</p>
        <canvas id="c7" width="300" height="300" style="border-radius:50%; background:radial-gradient(circle, #333, #000)"></canvas>
    </section>

    <!-- 8. BURBUJAS FM -->
    <section id="s8">
        <button id="mute-s8" class="mute-toggle muted" onclick="toggleMute('s8')">游댆 ACTIVAR</button>
        <h2>8. Burbujas FM</h2>
        <p>Haz clic para crear burbujas que suenan al flotar.</p>
        <canvas id="c8" width="600" height="300"></canvas>
    </section>

    <!-- 9. ECOS -->
    <section id="s9">
        <button id="mute-s9" class="mute-toggle muted" onclick="toggleMute('s9')">游댆 ACTIVAR</button>
        <h2>9. C치mara de Eco</h2>
        <p>Sonidos que se repiten en el infinito.</p>
        <canvas id="c9" width="600" height="300"></canvas>
    </section>

    <!-- 10. CUERDA TENSA -->
    <section id="s10">
        <button id="mute-s10" class="mute-toggle muted" onclick="toggleMute('s10')">游댆 ACTIVAR</button>
        <h2>10. La Cuerda Viva</h2>
        <p>Arrastra la cuerda. Observa c칩mo brilla con la vibraci칩n.</p>
        <canvas id="c10" width="600" height="200"></canvas>
    </section>

    <!-- 11. ORBITAS -->
    <section id="s11">
        <button id="mute-s11" class="mute-toggle muted" onclick="toggleMute('s11')">游댆 ACTIVAR</button>
        <h2>11. 칍rbitas de Acordes</h2>
        <p>Planetas que cantan al cruzar el horizonte.</p>
        <canvas id="c11" width="400" height="400"></canvas>
    </section>

    <!-- 12. RADIO -->
    <section id="s12">
        <button id="mute-s12" class="mute-toggle muted" onclick="toggleMute('s12')">游댆 ACTIVAR</button>
        <h2>12. Radio C칩smica</h2>
        <p>Mueve el dial (mouse X) para encontrar la se침al entre el ruido.</p>
        <canvas id="c12" width="600" height="150" style="background:#112"></canvas>
    </section>

    <!-- 13. GLITCH GRID -->
    <section id="s13">
        <button id="mute-s13" class="mute-toggle muted" onclick="toggleMute('s13')">游댆 ACTIVAR</button>
        <h2>13. Glitch Grid</h2>
        <p>Pasa el mouse para causar errores digitales sonoros.</p>
        <div id="glitch-grid" style="display:grid; grid-template-columns:repeat(10,1fr); gap:2px; width:600px; height:200px;"></div>
    </section>

    <!-- 14. DOPPLER -->
    <section id="s14">
        <button id="mute-s14" class="mute-toggle muted" onclick="toggleMute('s14')">游댆 ACTIVAR</button>
        <h2>14. T칰nel Doppler 3D</h2>
        <p>Escucha c칩mo el sonido se acerca y se aleja (Usa Aud칤fonos).</p>
        <canvas id="c14" width="600" height="300"></canvas>
    </section>

    <!-- 15. PINTURA -->
    <section id="s15">
        <button id="mute-s15" class="mute-toggle muted" onclick="toggleMute('s15')">游댆 ACTIVAR</button>
        <h2>15. Pintura Sonora</h2>
        <p>Dibuja y el canvas se convierte en sonido.</p>
        <canvas id="c15" width="600" height="300" style="background:black"></canvas>
        <button class="control-btn" onclick="clearCanvas15()">Limpiar Lienzo</button>
    </section>

    <script>
        // --- MOTOR DE AUDIO ---
        let ac; // AudioContext
        let master;
        const scale = [130.81, 146.83, 164.81, 196.00, 220.00, 261.63, 293.66, 329.63, 392.00, 440.00]; // C Pentatonic
        
        // ESTADO DE MUTE (Todo inicia en TRUE / Apagado)
        const muteStates = {
            s1: true, s2: true, s3: true, s4: true, s5: true,
            s6: true, s7: true, s8: true, s9: true, s10: true,
            s11: true, s12: true, s13: true, s14: true, s15: true
        };

        function toggleMute(id) {
            muteStates[id] = !muteStates[id];
            const btn = document.getElementById('mute-' + id);
            
            // Si est치 muteado (true) -> Mostrar opci칩n para activar
            // Si NO est치 muteado (false) -> Mostrar opci칩n para silenciar
            if (muteStates[id]) {
                btn.innerText = "游댆 ACTIVAR";
                btn.classList.add('muted');
                // L칩gica espec칤fica para sonidos continuos al apagar
                if(id === 's12' && radioGain) radioGain.gain.value = 0;
            } else {
                btn.innerText = "游댉 SILENCIAR";
                btn.classList.remove('muted');
            }
        }

        function initAudio() {
            if (ac) return;
            ac = new (window.AudioContext || window.webkitAudioContext)();
            master = ac.createGain();
            master.gain.value = 0.3;
            master.connect(ac.destination);
            
            document.getElementById('start-overlay').style.opacity = 0;
            setTimeout(() => document.getElementById('start-overlay').remove(), 500);
            
            // Iniciar loops
            requestAnimationFrame(loopAll);
            startSequencer();
        }

        function playOsc(freq, type, dur, vol=0.5, pan=0) {
            if(!ac) return;
            const osc = ac.createOscillator();
            const gain = ac.createGain();
            const panner = ac.createStereoPanner();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, ac.currentTime);
            
            panner.pan.value = pan;
            gain.gain.setValueAtTime(vol, ac.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + dur);
            
            osc.connect(panner);
            panner.connect(gain);
            gain.connect(master);
            
            osc.start();
            osc.stop(ac.currentTime + dur);
        }

        function scrollToId(id) { document.getElementById(id).scrollIntoView({behavior:'smooth'}); }

        // --- GAME LOOPS ---
        function loopAll() {
            if(ac) {
                drawGravity();
                drawPendulums();
                drawLightPrism(); // Nueva Exp 6
                drawBubbles();
                drawOrbits();
                drawDoppler();
                drawPainting();
            }
            requestAnimationFrame(loopAll);
        }

        // 1. THEREMIN
        const c1 = document.getElementById('c1');
        const ctx1 = c1.getContext('2d');
        let tOsc, tGain;
        
        c1.addEventListener('mouseenter', () => {
            if(!ac || muteStates['s1']) return; // Check Mute
            tOsc = ac.createOscillator();
            tGain = ac.createGain();
            tOsc.connect(tGain); tGain.connect(master);
            tOsc.start();
        });
        c1.addEventListener('mouseleave', () => {
            if(tOsc) { tOsc.stop(); tOsc = null; }
        });
        c1.addEventListener('mousemove', e => {
            const r = c1.getBoundingClientRect();
            const x = e.clientX - r.left;
            const y = e.clientY - r.top;
            const freq = 200 + (x/c1.width)*800;
            const vol = 1 - (y/c1.height);

            if(tOsc) {
                if(muteStates['s1']) {
                    tGain.gain.setTargetAtTime(0, ac.currentTime, 0.1);
                } else {
                    tOsc.frequency.setTargetAtTime(freq, ac.currentTime, 0.1);
                    tGain.gain.setTargetAtTime(vol, ac.currentTime, 0.1);
                }
            } else if (!muteStates['s1'] && e.buttons > 0 && ac) {
                 // Restart if re-entering while pressed (simplified logic handled by mouseenter)
            }
            
            ctx1.fillStyle = 'rgba(0,0,0,0.1)';
            ctx1.fillRect(0,0,600,300);
            ctx1.fillStyle = `hsl(${freq/5}, 100%, 50%)`;
            ctx1.beginPath(); ctx1.arc(x,y,20,0,Math.PI*2); ctx1.fill();
        });

        // 2. SECUENCIADOR
        const seqGrid = document.getElementById('sequencer');
        let seqData = Array(4).fill(0).map(() => Array(8).fill(false)); // 4 tracks, 8 steps
        let currentStep = 0;
        
        for(let r=0; r<4; r++) {
            let row = document.createElement('div');
            row.className = 'seq-row';
            for(let c=0; c<8; c++) {
                let cell = document.createElement('div');
                cell.className = 'seq-cell';
                cell.id = `seq-${r}-${c}`;
                cell.onclick = () => { 
                    seqData[r][c] = !seqData[r][c]; 
                    cell.classList.toggle('active'); 
                };
                row.appendChild(cell);
            }
            seqGrid.appendChild(row);
        }
        
        function startSequencer() {
            setInterval(() => {
                if(!ac) return;
                // Visual
                for(let r=0; r<4; r++) {
                    document.getElementById(`seq-${r}-${(currentStep-1+8)%8}`).classList.remove('playing');
                    document.getElementById(`seq-${r}-${currentStep}`).classList.add('playing');
                    
                    if(seqData[r][currentStep] && !muteStates['s2']) { // Check Mute
                        // Play sounds (Kick, Snare, Hihat, Synth)
                        if(r==0) playOsc(150, 'sine', 0.1, 0.8); // Kick-ish
                        if(r==1) playNoiseEnv(0.1); // Snare-ish
                        if(r==2) playOsc(8000, 'square', 0.05, 0.1); // Hihat
                        if(r==3) playOsc(scale[Math.floor(Math.random()*5)]*2, 'triangle', 0.2); // Melody
                    }
                }
                currentStep = (currentStep + 1) % 8;
            }, 250);
        }
        function playNoiseEnv(dur) {
            if(!ac) return;
            const buf = ac.createBuffer(1, ac.sampleRate*dur, ac.sampleRate);
            const d = buf.getChannelData(0);
            for(let i=0; i<d.length; i++) d[i] = Math.random()*2-1;
            const n = ac.createBufferSource(); n.buffer = buf;
            const g = ac.createGain(); g.gain.value = 0.2; g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime+dur);
            n.connect(g); g.connect(master); n.start();
        }
        function clearSeq() {
            seqData = seqData.map(r => r.fill(false));
            document.querySelectorAll('.seq-cell').forEach(c => c.classList.remove('active'));
        }

        // 3. GRAVEDAD
        const c3 = document.getElementById('c3');
        const ctx3 = c3.getContext('2d');
        let balls = [];
        
        c3.addEventListener('mousedown', e => {
            const r = c3.getBoundingClientRect();
            balls.push({
                x: e.clientX - r.left, y: e.clientY - r.top,
                vx: (Math.random()-0.5)*10, vy: 0,
                col: `hsl(${Math.random()*360},100%,50%)`
            });
        });
        
        function drawGravity() {
            ctx3.fillStyle = 'rgba(0,0,0,0.2)';
            ctx3.fillRect(0,0,600,300);
            balls.forEach(b => {
                b.vy += 0.5; b.x += b.vx; b.y += b.vy;
                if(b.y > 290) { 
                    b.y = 290; b.vy *= -0.8; 
                    if(Math.abs(b.vy) > 1 && !muteStates['s3']) playOsc(200 + b.x, 'sine', 0.1);
                }
                if(b.x < 0 || b.x > 600) { 
                    b.vx *= -1; 
                    if(!muteStates['s3']) playOsc(800 - b.x, 'triangle', 0.1); 
                }
                ctx3.fillStyle = b.col;
                ctx3.beginPath(); ctx3.arc(b.x, b.y, 10, 0, Math.PI*2); ctx3.fill();
            });
        }

        // 4. ARPA L츼SER
        const c4 = document.getElementById('c4');
        const ctx4 = c4.getContext('2d');
        // Dibujar cuerdas est치ticas
        function drawHarp() {
            ctx4.clearRect(0,0,600,300);
            for(let i=0; i<10; i++) {
                ctx4.strokeStyle = `hsl(${i*36}, 100%, 50%)`;
                ctx4.lineWidth = 2;
                ctx4.beginPath(); ctx4.moveTo(50 + i*50, 0); ctx4.lineTo(50 + i*50, 300); ctx4.stroke();
            }
        }
        drawHarp();
        
        let lastString = -1;
        c4.addEventListener('mousemove', e => {
            const r = c4.getBoundingClientRect();
            const x = e.clientX - r.left;
            const strIdx = Math.floor((x - 25) / 50);
            
            if(strIdx >= 0 && strIdx < 10 && strIdx !== lastString) {
                // Pluck
                if(!muteStates['s4']) playOsc(scale[strIdx] || 440, 'sawtooth', 0.5, 0.2);
                // Visual feedback
                ctx4.fillStyle = 'white';
                ctx4.fillRect(50 + strIdx*50 - 2, 0, 4, 300);
                setTimeout(drawHarp, 100);
                lastString = strIdx;
            } else if (strIdx < 0 || strIdx >= 10) {
                lastString = -1;
            }
        });

        // 5. P칄NDULOS
        const c5 = document.getElementById('c5');
        const ctx5 = c5.getContext('2d');
        let pTime = 0;
        
        function drawPendulums() {
            ctx5.clearRect(0,0,600,300);
            pTime += 0.01;
            
            for(let i=0; i<8; i++) {
                const len = 100 + i*20;
                const freq = 1 + i*0.1;
                const angle = Math.sin(pTime * freq) * 1; // Oscilaci칩n
                const x = 300 + Math.sin(angle) * len;
                const y = Math.cos(angle) * len;
                
                ctx5.strokeStyle = 'white';
                ctx5.beginPath(); ctx5.moveTo(300, 0); ctx5.lineTo(x, y); ctx5.stroke();
                ctx5.beginPath(); ctx5.arc(x, y, 10, 0, Math.PI*2); ctx5.fillStyle = `hsl(${i*40},100%,50%)`; ctx5.fill();
                
                // Trigger en extremos
                if (Math.abs(Math.sin((pTime-0.01)*freq)) < 0.99 && Math.abs(Math.sin(pTime*freq)) >= 0.99) {
                    if(!muteStates['s5']) playOsc(scale[i]*2, 'triangle', 0.2, 0.1, (x-300)/300);
                }
            }
        }
        function resetPendulums() { pTime = 0; }

        // 6. PRISMA DE LUZ (REEMPLAZO DE LLUVIA)
        const c6 = document.getElementById('c6');
        const ctx6 = c6.getContext('2d');
        let rays = [];

        c6.addEventListener('mousemove', e => {
            if(muteStates['s6']) return;
            const r = c6.getBoundingClientRect();
            const x = e.clientX - r.left;
            const y = e.clientY - r.top;
            
            rays.push({x: x, y: y, age: 0, hue: (x/600)*360});
            
            // Sonido cristalino basado en altura
            if(Math.random() > 0.6) {
                playOsc(800 - y, 'sine', 0.1, 0.1);
            }
        });

        function drawLightPrism() {
            ctx6.fillStyle = 'rgba(0,0,0,0.1)'; 
            ctx6.fillRect(0,0,600,300);
            
            ctx6.lineWidth = 2;
            
            for(let i=0; i<rays.length; i++) {
                let p = rays[i];
                p.age++;
                ctx6.strokeStyle = `hsla(${p.hue}, 100%, 50%, ${(50-p.age)/50})`;
                ctx6.beginPath();
                ctx6.moveTo(p.x, p.y);
                // Conectar con punto random cercano para efecto "rayo"
                ctx6.lineTo(p.x + (Math.random()-0.5)*50, p.y + (Math.random()-0.5)*50);
                ctx6.stroke();
                
                if(p.age > 30) {
                    rays.splice(i, 1);
                    i--;
                }
            }
        }

        // 7. VOCALES
        const c7 = document.getElementById('c7');
        const ctx7 = c7.getContext('2d');
        let vOsc;
        
        // Simulaci칩n simple de vocales usando frecuencia y filtro
        // X = vowel selection (Low pass filter freq), Y = Pitch
        c7.addEventListener('mouseenter', () => {
            if(!ac || muteStates['s7']) return;
            vOsc = ac.createOscillator();
            vOsc.type = 'sawtooth';
            // Crear filtro para simular formantes
            const f = ac.createBiquadFilter();
            f.type = 'bandpass';
            f.Q.value = 10;
            vOsc.connect(f);
            f.connect(master);
            vOsc.start();
            c7.filterNode = f;
        });
        c7.addEventListener('mouseleave', () => { if(vOsc) { vOsc.stop(); vOsc = null; } });
        c7.addEventListener('mousemove', e => {
            const r = c7.getBoundingClientRect();
            const x = e.clientX - r.left;
            const y = e.clientY - r.top;
            
            if(muteStates['s7']) {
                if(vOsc) { vOsc.stop(); vOsc = null; }
            } else {
                if(!vOsc && ac && e.buttons) { /* Restart logic could be here */ }
                if(vOsc) {
                    vOsc.frequency.value = 100 + (300 - y); // Pitch
                    c7.filterNode.frequency.value = 200 + x * 5; // Vowel "color"
                }
            }
            
            // Visual
            ctx7.clearRect(0,0,300,300);
            ctx7.beginPath(); ctx7.arc(x,y,20,0,Math.PI*2);
            ctx7.fillStyle = 'white'; ctx7.fill();
            ctx7.font = "20px monospace"; ctx7.fillText("A E I O U", 100, 150);
        });

        // 8. BURBUJAS
        const c8 = document.getElementById('c8');
        const ctx8 = c8.getContext('2d');
        let bubbles = [];
        
        c8.addEventListener('mousedown', e => {
            const r = c8.getBoundingClientRect();
            bubbles.push({
                x: e.clientX - r.left, y: e.clientY - r.top,
                r: 0, maxR: Math.random()*30+20,
                freq: 200 + Math.random()*800
            });
            // FM Pop sound
            if(!muteStates['s8']) {
                const o = ac.createOscillator();
                const m = ac.createOscillator();
                const g = ac.createGain();
                m.frequency.value = 50; 
                m.connect(o.frequency);
                o.connect(g); g.connect(master);
                o.frequency.setValueAtTime(200, ac.currentTime);
                o.frequency.exponentialRampToValueAtTime(800, ac.currentTime+0.1);
                g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime+0.1);
                o.start(); m.start();
                o.stop(ac.currentTime+0.1); m.stop(ac.currentTime+0.1);
            }
        });
        
        function drawBubbles() {
            ctx8.clearRect(0,0,600,300);
            bubbles.forEach((b, i) => {
                b.y -= 1; b.r += 0.5;
                ctx8.strokeStyle = `hsl(${b.freq/5}, 100%, 50%)`;
                ctx8.beginPath(); ctx8.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx8.stroke();
                if(b.r > b.maxR) bubbles.splice(i, 1);
            });
        }

        // 9. ECOS
        const c9 = document.getElementById('c9');
        const ctx9 = c9.getContext('2d');
        // Simple visualizer for delay concepts (click creates circles)
        let echoes = [];
        c9.addEventListener('mousedown', e => {
            const r = c9.getBoundingClientRect();
            const x = e.clientX - r.left;
            
            // Create audio echo
            if(!muteStates['s9']) {
                const osc = ac.createOscillator();
                const gain = ac.createGain();
                const delay = ac.createDelay();
                const feedback = ac.createGain();
                
                delay.delayTime.value = 0.3;
                feedback.gain.value = 0.6;
                
                osc.frequency.value = 200 + x;
                osc.type = 'triangle';
                
                osc.connect(gain);
                gain.connect(master);
                gain.connect(delay);
                delay.connect(feedback);
                feedback.connect(delay);
                feedback.connect(master);
                
                gain.gain.setValueAtTime(0.5, ac.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + 0.1);
                
                osc.start(); osc.stop(ac.currentTime + 0.1);
            }
            
            // Visual echo
            echoes.push({x: x, y: e.clientY-r.top, r: 0});
        });
        
        // Loop echo visuals in loopAll() or here?
        // We'll add to main loop for simplicity, but defining separate draw function
        c9.draw = function() { // Attach to obj to keep clean
            ctx9.fillStyle = 'rgba(0,0,0,0.1)'; ctx9.fillRect(0,0,600,300);
            echoes.forEach((e, i) => {
                e.r += 2;
                ctx9.strokeStyle = 'white';
                ctx9.beginPath(); ctx9.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx9.stroke();
                if(e.r > 300) echoes.splice(i, 1);
            });
        };
        // Hook into loopAll
        const oldLoop = loopAll;
        loopAll = function() {
            // Updated Loop
            if(ac) {
                drawGravity();
                drawPendulums();
                drawLightPrism();
                drawBubbles();
                c9.draw(); // Ecos
                drawString(); // Cuerda (Modified below)
                drawOrbits();
                drawDoppler();
                drawPainting();
            }
            requestAnimationFrame(loopAll);
        }

        // 10. CUERDA TENSA (MEJORADA CON COLOR VIBRANTE)
        const c10 = document.getElementById('c10');
        const ctx10 = c10.getContext('2d');
        let stringY = 100;
        let stringVel = 0;
        let isDraggingStr = false;
        
        c10.addEventListener('mousedown', e => {
            const r = c10.getBoundingClientRect();
            if(Math.abs(e.clientY - r.top - 100) < 20) isDraggingStr = true;
        });
        window.addEventListener('mouseup', () => {
            if(isDraggingStr) {
                isDraggingStr = false;
                // Pluck sound
                if(!muteStates['s10']) playOsc(110, 'sawtooth', 1.0);
            }
        });
        c10.addEventListener('mousemove', e => {
            if(isDraggingStr) {
                const r = c10.getBoundingClientRect();
                stringY = e.clientY - r.top;
            }
        });
        
        function drawString() { 
            ctx10.clearRect(0,0,600,200);
            
            if(!isDraggingStr) {
                const force = (100 - stringY) * 0.1;
                stringVel += force;
                stringVel *= 0.95; 
                stringY += stringVel;
            }
            
            // Color Logic based on vibration intensity
            const vib = Math.abs(stringY - 100);
            ctx10.lineWidth = 3 + vib/10;
            
            if(vib > 1) {
                // Vibrando: Colores RGB
                const hue = (Date.now() / 2) % 360; 
                ctx10.strokeStyle = `hsl(${hue}, 100%, 70%)`;
                ctx10.shadowBlur = vib + 5;
                ctx10.shadowColor = `hsl(${hue}, 100%, 50%)`;
            } else {
                // Quieta
                ctx10.strokeStyle = 'var(--neon-pink)';
                ctx10.shadowBlur = 0;
            }
            
            ctx10.beginPath();
            ctx10.moveTo(0, 100);
            ctx10.quadraticCurveTo(300, stringY, 600, 100);
            ctx10.stroke();
            
            // Reset context shadow for safety
            ctx10.shadowBlur = 0;
        }

        // 11. ORBITAS
        const c11 = document.getElementById('c11');
        const ctx11 = c11.getContext('2d');
        let planets = [
            {r: 50, s: 0.02, a: 0, note: scale[0]},
            {r: 100, s: 0.015, a: 0, note: scale[2]},
            {r: 150, s: 0.01, a: 0, note: scale[4]}
        ];
        
        function drawOrbits() {
            ctx11.fillStyle = 'rgba(0,0,0,0.1)'; ctx11.fillRect(0,0,400,400);
            ctx11.translate(200, 200);
            
            // Horizon line
            ctx11.strokeStyle = '#333'; ctx11.beginPath(); ctx11.moveTo(-200,0); ctx11.lineTo(200,0); ctx11.stroke();
            
            planets.forEach(p => {
                p.a += p.s;
                const x = Math.cos(p.a) * p.r;
                const y = Math.sin(p.a) * p.r;
                
                // Sound trigger on crossing Y axis
                if(Math.abs(y) < 2) {
                    ctx11.fillStyle = 'white';
                    if(!muteStates['s11']) playOsc(p.note, 'sine', 0.2, 0.1);
                } else {
                    ctx11.fillStyle = 'var(--neon-cyan)';
                }
                
                ctx11.beginPath(); ctx11.arc(x, y, 5, 0, Math.PI*2); ctx11.fill();
            });
            ctx11.translate(-200, -200);
        }

        // 12. RADIO
        const c12 = document.getElementById('c12');
        const ctx12 = c12.getContext('2d');
        let noiseNode, radioGain;
        
        // Create noise once
        function initRadio() {
            if(!ac || noiseNode) return;
            const size = ac.sampleRate * 2;
            const b = ac.createBuffer(1, size, ac.sampleRate);
            const d = b.getChannelData(0);
            for(let i=0; i<size; i++) d[i] = Math.random()*2-1;
            noiseNode = ac.createBufferSource();
            noiseNode.buffer = b;
            noiseNode.loop = true;
            radioGain = ac.createGain();
            radioGain.gain.value = 0;
            noiseNode.connect(radioGain);
            radioGain.connect(master);
            noiseNode.start();
        }
        
        c12.addEventListener('mouseenter', initRadio);
        c12.addEventListener('mousemove', e => {
            if(!radioGain) return;
            const r = c12.getBoundingClientRect();
            const x = e.clientX - r.left;
            
            // Stations at 100, 300, 500
            const stations = [100, 300, 500];
            let signal = 0;
            let tuning = 0;
            
            stations.forEach(s => {
                const dist = Math.abs(x - s);
                if(dist < 20) {
                    tuning = 1 - (dist/20);
                    signal = 1; // Found station
                }
            });
            
            // Mix noise and signal
            if (muteStates['s12']) {
                radioGain.gain.value = 0;
            } else {
                radioGain.gain.value = (1 - tuning) * 0.2; // More noise if far
                
                if(tuning > 0.1 && Math.random() < 0.1) {
                    // Play sine blip if tuned
                    playOsc(1000 * tuning, 'sine', 0.05, tuning*0.5);
                }
            }
            
            // Visual
            ctx12.fillStyle = 'black'; ctx12.fillRect(0,0,600,150);
            ctx12.fillStyle = 'red'; ctx12.fillRect(x, 0, 2, 150);
            
            // Static visual
            for(let i=0; i<50; i++) {
                ctx12.fillStyle = 'white';
                ctx12.fillRect(Math.random()*600, Math.random()*150, 2, 2);
            }
            if(tuning > 0.5) {
                ctx12.font = "30px monospace";
                ctx12.fillStyle = "var(--neon-lime)";
                ctx12.fillText("SIGNAL FOUND", 200, 80);
            }
        });
        c12.addEventListener('mouseleave', () => { if(radioGain) radioGain.gain.value = 0; });

        // 13. GLITCH GRID
        const gGrid = document.getElementById('glitch-grid');
        for(let i=0; i<20; i++) {
            let d = document.createElement('div');
            d.style.backgroundColor = '#222';
            d.style.border = '1px solid #333';
            d.onmouseenter = function() {
                this.style.backgroundColor = 'white';
                setTimeout(()=>this.style.backgroundColor='#222', 100);
                if(!muteStates['s13']) {
                    playNoiseEnv(Math.random()*0.1);
                    if(Math.random()>0.5) playOsc(Math.random()*2000, 'sawtooth', 0.05);
                }
            };
            gGrid.appendChild(d);
        }

        // 14. DOPPLER
        const c14 = document.getElementById('c14');
        const ctx14 = c14.getContext('2d');
        let dObj = {x: -50, v: 5};
        
        function drawDoppler() {
            ctx14.clearRect(0,0,600,300);
            dObj.x += dObj.v;
            if(dObj.x > 650) dObj.x = -50;
            
            // Visual car
            ctx14.fillStyle = 'var(--neon-red)';
            ctx14.fillRect(dObj.x, 140, 40, 20);
            
            // Listener in center
            ctx14.fillStyle = 'white';
            ctx14.beginPath(); ctx14.arc(300, 150, 5, 0, Math.PI*2); ctx14.fill();
            
            // Audio logic on pass
            // Simple volume/pitch sim
            const dist = dObj.x - 300;
            if(Math.abs(dist) < 300 && Math.abs(dist) % 20 < 5 && !muteStates['s14']) {
                // Play pulse
                // Pitch higher when approaching (-dist), lower when leaving (+dist)
                let pitch = 400;
                if(dist < 0) pitch = 500; // Coming
                else pitch = 300; // Going
                
                // Pan
                const pan = dist / 300;
                playOsc(pitch, 'sawtooth', 0.05, 0.1, pan);
            }
        }

        // 15. PINTURA SONORA
        const c15 = document.getElementById('c15');
        const ctx15 = c15.getContext('2d');
        let isPainting = false;
        
        c15.addEventListener('mousedown', () => isPainting=true);
        window.addEventListener('mouseup', () => isPainting=false);
        c15.addEventListener('mousemove', e => {
            if(!isPainting) return;
            const r = c15.getBoundingClientRect();
            const x = e.clientX - r.left;
            const y = e.clientY - r.top;
            
            const hue = (x/600) * 360;
            ctx15.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx15.beginPath(); ctx15.arc(x,y,10,0,Math.PI*2); ctx15.fill();
            
            // Play freq based on Y
            if(!muteStates['s15']) {
                const freq = 1000 - (y/300)*800;
                playOsc(freq, 'sine', 0.1);
            }
        });
        
        function drawPainting() {
            // Fade out
            ctx15.fillStyle = 'rgba(0,0,0,0.02)';
            ctx15.fillRect(0,0,600,300);
        }
        function clearCanvas15() { ctx15.clearRect(0,0,600,300); }

    </script>
</body>
</html>
